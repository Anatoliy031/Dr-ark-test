<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>С днём рождения, Аркадий Адреевич!</title>

  <!-- Шрифты (чёткие и лёгкие для рендера) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#eaf1ff;
      --muted:#becaf8;
      --gold:#f6c453;
      --bg1:#0b1020;
      --bg2:#121a33;
      --glass-b: rgba(255,255,255,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      font-family: Manrope, Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 420px at 12% 12%, #1a2344 0%, transparent 65%),
        radial-gradient(760px 360px at 88% 6%, #16224a 0%, transparent 70%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100dvh;
      overflow:hidden;
    }

    /* Мягкое сияние (урезали blur и насыщенность для стабильности FPS) */
    .aurora,.aurora::before,.aurora::after{
      position:fixed; inset:-20vmax; content:""; z-index:0; pointer-events:none;
      filter: blur(42px) saturate(108%);
      background:
        radial-gradient(45% 35% at 18% 30%, rgba(0,180,240,.18), transparent 60%),
        radial-gradient(40% 30% at 84% 20%, rgba(0,120,255,.12), transparent 60%),
        radial-gradient(35% 30% at 52% 82%, rgba(255,215,128,.12), transparent 60%);
      animation: drift 30s linear infinite;
    }
    .aurora::before{ animation-duration: 38s; mix-blend-mode:screen }
    .aurora::after{ animation-duration: 46s; mix-blend-mode:overlay }
    @keyframes drift{
      0%{transform:translate3d(-1.5%, -1%, 0) rotate(0deg) scale(1.02)}
      50%{transform:translate3d(1.5%, 1%, 0) rotate(180deg) scale(1.04)}
      100%{transform:translate3d(-1.5%, -1%, 0) rotate(360deg) scale(1.02)}
    }

    /* Упростили «звёзды», чтобы не мигали резко */
    .stars{
      position:fixed; inset:0; z-index:1; pointer-events:none; opacity:.6;
      background-image:
        radial-gradient(1.6px 1.6px at 20% 30%, rgba(255,255,255,.8) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 70% 20%, rgba(255,255,255,.7) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 40% 70%, rgba(255,255,255,.8) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 85% 65%, rgba(255,255,255,.85) 50%, transparent 52%);
      animation: twinkle 6s ease-in-out infinite alternate;
    }
    @keyframes twinkle{ from{opacity:.35} to{opacity:.8} }

    /* Канвасы эффектов */
    canvas#confetti, canvas#fireworks{
      position:fixed; inset:0; width:100vw; height:100dvh; pointer-events:none;
    }
    #confetti{ z-index:1.2 }
    #fireworks{ z-index:1.3 }

    /* Карточка */
    .wrap{
      position:relative; z-index:3; min-height:100dvh; width:100%;
      display:grid; place-items:center; padding:clamp(12px, 4vmin, 44px);
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
    }
    .card{
      width:min(960px, 96vw);
      padding:clamp(18px, 5vmin, 44px);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid var(--glass-b);
      border-radius:22px;
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 44px rgba(0,0,0,.32), inset 0 0 0 1px rgba(255,255,255,.05);
      position:relative; overflow:hidden;
    }
    .card::before{
      content:""; position:absolute; inset:-2px; border-radius:24px; padding:2px;
      background: conic-gradient(from 0deg, #ffd16b, #00b4f0, #ffffff33, #ffd16b);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      animation: borderGlow 10s linear infinite;
    }
    @keyframes borderGlow{ to{ filter:hue-rotate(360deg) } }

    .badge{
      display:inline-flex; align-items:center; gap:.6rem;
      padding:.5rem .85rem; border-radius:999px;
      font-weight:800; letter-spacing:.06em; text-transform:uppercase;
      background: linear-gradient(90deg, rgba(246,196,83,.22), rgba(255,255,255,.06));
      border:1px solid rgba(246,196,83,.55); color:#ffd16b;
      backdrop-filter: blur(4px); font-size:.78rem;
    }

    h1{
      margin:10px 0 2px;
      font-family: Montserrat, Manrope, system-ui, sans-serif;
      font-weight:900; line-height:1.05;
      font-size: clamp(28px, 8vw, 58px);
      letter-spacing:.02em;
      background: linear-gradient(180deg, #fff, #d9ecff 55%, #aee3ff);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 10px 24px rgba(0,0,0,.28);
      min-height:2.6em;
    }

    .subtitle{
      margin:0 0 12px; color:var(--muted); font-weight:700;
      font-size: clamp(13px, 3.7vw, 18px);
      min-height:1.6em;
    }

    .msg{
      font-size: clamp(15px, 3.9vw, 19px);
      line-height:1.68; color:#eef3ff; margin:10px 0 0;
      min-height:1.7em;
    }
    .msg b{ color:#fff }

    .cursor::after{
      content:""; display:inline-block;
      width:0.55ch; height:1.05em; margin-left:2px;
      background: linear-gradient(180deg, #ffffff, #b8d7ff);
      border-radius:2px; animation:blink 1.1s steps(1) infinite; vertical-align:-0.15em;
    }
    @keyframes blink{50%{opacity:0}}

    .footer{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:18px; color:#d3ddff; font-size:.95rem;
      border-top:1px dashed rgba(255,255,255,.22); padding-top:14px;
      min-height:2.2em;
    }
    .team{font-weight:800;color:#fff}

    @media (max-width:480px){
      .card{border-radius:20px;padding:18px}
      .badge{font-size:.72rem}
    }
    @media (prefers-reduced-motion: reduce){
      .aurora,.aurora::before,.aurora::after{animation:none}
      .stars{animation:none}
    }
  </style>
</head>
<body>
  <div class="aurora" aria-hidden="true"></div>
  <div class="stars" aria-hidden="true"></div>

  <!-- Фоны (оптимизировано против мерцания): конфетти + салюты -->
  <canvas id="confetti" aria-hidden="true"></canvas>
  <canvas id="fireworks" aria-hidden="true"></canvas>

  <div class="wrap">
    <section class="card" aria-label="Праздничное поздравление">
      <div class="badge">Коллектив ДРНУ</div>

      <h1 id="h1" class="cursor"></h1>
      <p id="sub" class="subtitle cursor"></p>

      <p id="m1" class="msg cursor"></p>
      <p id="m2" class="msg cursor"></p>
      <p id="m3" class="msg cursor"></p>
      <p id="m4" class="msg cursor"></p>

      <div class="footer">
        <div class="team">С уважением, команда ДРНУ</div>
        <div id="date"></div>
      </div>
    </section>
  </div>

  <script>
    // ======= Дата =======
    (function(){
      const today = new Date();
      document.getElementById('date').textContent = today.toLocaleDateString('ru-RU', {
        year:'numeric', month:'long', day:'numeric'
      });
    })();

    // ======= УТИЛЫ ПЕЧАТИ (добавили ПАУЗУ перед стиранием) =======
    const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));
    const $ = (q)=> document.querySelector(q);

    async function typeText(node, text, speed=26, jitter=18){
      for(let i=0;i<text.length;i++){
        node.textContent += text[i];
        await sleep(speed + Math.random()*jitter);
      }
    }
    async function backspace(node, n, speed=16){
      for(let i=0;i<n;i++){
        node.textContent = node.textContent.slice(0,-1);
        await sleep(speed);
      }
    }
    const stopCursor = (node)=> node.classList.remove('cursor');

    // Печать с комической заменой слова: ПАУЗА 1.2с перед удалением
    async function typeWithCorrections(node, before, variants, after, opts={}){
      const {speed=26, pauseBeforeErase=1200} = opts;
      await typeText(node, before, speed);
      const word = document.createElement('span');
      node.appendChild(word);
      for(let i=0;i<variants.length;i++){
        const w = variants[i];
        await typeText(word, w, speed+2);
        await sleep(pauseBeforeErase);       // читаем слово
        await backspace(word, w.length, 14); // аккуратно стираем
        await sleep(180);                    // короткая пауза перед след. словом
      }
      const finalWord = variants[variants.length-1];
      await typeText(word, finalWord, speed);
      await typeText(node, after, speed);
    }

    // ======= СЦЕНАРИЙ ПЕЧАТИ =======
    (async function(){
      const h1 = $('#h1'), sub = $('#sub');
      const m1 = $('#m1'), m2 = $('#m2'), m3 = $('#m3'), m4 = $('#m4');

      await typeText(h1, 'С днём рождения, ', 30, 14);
      await typeText(h1, 'Аркадий Адреевич!', 32, 12);
      stopCursor(h1); sub.classList.add('cursor'); await sleep(280);

      await typeText(sub, 'Лучший работник и надёжный начальник отдела', 24, 14);
      stopCursor(sub); await sleep(260);

      await typeText(m1, 'От всего коллектива ДРНУ — самые тёплые поздравления!', 24, 12);
      stopCursor(m1); await sleep(300);

      m2.textContent = '';
      await typeWithCorrections(
        m2,
        'Ты настолько ответственен, что мы иногда забываем тебя ',
        ['контролировать', 'надзирать', 'проверять', 'напоминать', 'просто хвалить'],
        '.',
        {speed:23, pauseBeforeErase:1300} // БОЛЬШЕ ПАУЗА ДЛЯ ЧТЕНИЯ
      );
      stopCursor(m2); await sleep(320);

      m3.textContent = '';
      await typeText(m3, 'Мы видим твой вклад и профессионализм — благодаря тебе задачи становятся ', 23, 12);
      const tWord = document.createElement('span'); m3.appendChild(tWord);
      await typeText(tWord, 'сложнее', 24, 10);
      await sleep(1200);                       // Пауза перед заменой
      await backspace(tWord, 'сложнее'.length, 15);
      await sleep(220);
      await typeText(tWord, 'легче', 24, 10);
      await typeText(m3, ', сроки — реальнее, а результат — впечатляющим!', 23, 12);
      stopCursor(m3); await sleep(320);

      await typeText(m4, 'Желаем крепкого здоровья, семье — благополучия, а тебе — ярких побед и только лучших новостей каждый день!', 23, 12);
      stopCursor(m4);
    })();

    // ======= ПРОФИЛАКТИКА МЕРЦАНИЯ/НАГРУЗКИ =======
    const isPhone = ()=> innerWidth <= 480;
    // Жёсткая отсечка DPR до 1 для экономии памяти/перерисовок
    const DPR_LIMIT = isPhone()? 1 : 1.25;

    // ======= КОНФЕТТИ (урезано, частота кадров ~30fps) =======
    (function(){
      const c = document.getElementById('confetti');
      const ctx = c.getContext('2d');
      let W,H,DPR;

      function size(){
        DPR = Math.min(DPR_LIMIT, window.devicePixelRatio || 1);
        W = c.width = Math.floor(innerWidth*DPR);
        H = c.height = Math.floor(innerHeight*DPR);
        c.style.width = innerWidth+'px';
        c.style.height = innerHeight+'px';
      }
      addEventListener('resize', size, {passive:true}); size();

      const pieces = [];
      const COUNT = isPhone()? 60 : 100; // было больше — снизили
      const colors = ['#ffffff','#ffd166','#06d6a0','#118ab2','#ef476f','#a0e9ff','#ffe29a','#c3f584'];

      function spawn(i){
        const w = (Math.random()*5 + 4)*DPR;
        const h = (Math.random()*8 + 6)*DPR;
        pieces[i] = {
          x: Math.random()*W, y: -Math.random()*H,
          w, h,
          r: Math.random()*Math.PI,
          rv: (Math.random()*0.10 + 0.02) * (Math.random()<.5?-1:1),
          vy: (Math.random()*1.3 + 1.1)*DPR,
          vx: (Math.random()*0.55 - 0.28)*DPR,
          color: colors[(Math.random()*colors.length)|0],
          flip: Math.random()*Math.PI
        };
      }
      for(let i=0;i<COUNT;i++) spawn(i);

      // Троттлинг рендера до ~30fps
      let last = 0;
      function step(ts){
        if(ts - last < 33){ requestAnimationFrame(step); return; } // ~30fps
        last = ts;

        ctx.clearRect(0,0,W,H);
        for(let i=0;i<pieces.length;i++){
          const p = pieces[i];
          p.y += p.vy; p.x += p.vx; p.r += p.rv; p.flip += 0.07;
          const scaleY = (Math.sin(p.flip)+1.2)/2.2;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r);
          ctx.fillStyle = p.color; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h*scaleY);
          ctx.restore();
          if(p.y>H+40*DPR || p.x<-40*DPR || p.x>W+40*DPR){ spawn(i); p.y = -20*DPR; }
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    })();

    // ======= САЛЮТЫ (снижен поток частиц и частота) =======
    (function(){
      const canvas = document.getElementById('fireworks');
      const ctx = canvas.getContext('2d', {alpha:true});
      let W,H,DPR;

      function size(){
        DPR = Math.min(DPR_LIMIT, window.devicePixelRatio || 1);
        W = canvas.width = Math.floor(innerWidth*DPR);
        H = canvas.height = Math.floor(innerHeight*DPR);
        canvas.style.width = innerWidth+'px';
        canvas.style.height = innerHeight+'px';
      }
      addEventListener('resize', size, {passive:true}); size();

      const rand = (a,b)=> Math.random()*(b-a)+a;
      const TAU = Math.PI*2;
      const gravity = (isPhone()?0.03:0.038)*DPR;  // было выше
      const friction = 0.986;

      const rockets = [];
      const particles = [];
      const PARTICLE_CAP = isPhone()? 360 : 700;   // было больше

      function colorHSL(h,s,l){ return `hsl(${h} ${s}% ${l}%)` }

      function spawnRocket(x=rand(W*0.25,W*0.75), y=H, targetY=rand(H*0.32,H*0.52)){
        rockets.push({
          x, y, vx: rand(-0.7,0.7)*DPR, vy: rand(-9.5,-12)*DPR,
          targetY, hue: rand(180,360), trail:[]
        });
      }
      function explode(x,y,hue){
        const n = Math.floor(isPhone()? rand(38,62): rand(70,100)); // меньше частиц
        const shape = Math.random()<0.2?'ring':'burst';
        for(let i=0;i<n;i++){
          const ang = (i/n)*TAU + rand(-0.02,0.02);
          const spd = (shape==='ring'?2.8:rand(1.3,3.6))*DPR;
          particles.push({
            x,y, vx:Math.cos(ang)*spd, vy:Math.sin(ang)*spd,
            life: rand(50,85), alpha:1,
            color: colorHSL((hue+rand(-12,12))|0, 100, rand(56,70)),
            size: rand(0.9,1.8)*DPR, sparkle: Math.random()<0.14
          });
        }
        const crown = isPhone()?14:20;
        for(let i=0;i<crown;i++){
          const a = i/crown*TAU;
          particles.push({
            x,y, vx:Math.cos(a)*rand(1.0,1.9)*DPR, vy:Math.sin(a)*rand(1.0,1.9)*DPR,
            life: rand(40,62), alpha:1, color:'rgba(246,196,83,1)', size:1.4*DPR, sparkle:true
          });
        }
      }

      // Троттлинг до ~50fps, авто-спавн реже
      let last = 0;
      function step(ts){
        if(ts - last < 20){ requestAnimationFrame(step); return; } // ~50fps
        last = ts;

        ctx.clearRect(0,0,W,H);

        for(let i=rockets.length-1;i>=0;i--){
          const r = rockets[i];
          r.trail.push({x:r.x,y:r.y}); if(r.trail.length>5) r.trail.shift();
          r.x += r.vx; r.y += r.vy; r.vy += gravity*0.45;

          ctx.beginPath();
          for(let t=0;t<r.trail.length-1;t++){
            const a = t/(r.trail.length-1);
            ctx.strokeStyle = `hsla(${r.hue},100%,70%,${a*0.6})`;
            ctx.lineWidth = (1.1+a*1.7)*DPR;
            ctx.moveTo(r.trail[t].x, r.trail[t].y);
            ctx.lineTo(r.trail[t+1].x, r.trail[t+1].y);
          }
          ctx.stroke();

          ctx.fillStyle = colorHSL(r.hue,100,70);
          ctx.beginPath(); ctx.arc(r.x,r.y,1.9*DPR,0,TAU); ctx.fill();

          if(r.vy>=0 || r.y<=r.targetY || Math.random()<0.006){
            explode(r.x,r.y,r.hue); rockets.splice(i,1);
          }
        }

        // Частицы (cap + отрисовка)
        if(particles.length>PARTICLE_CAP) particles.splice(0, particles.length-PARTICLE_CAP);
        for(let i=particles.length-1;i>=0;i--){
          const p = particles[i];
          p.vx *= friction; p.vy = p.vy*friction + gravity;
          p.x += p.vx; p.y += p.vy;
          p.life--; p.alpha = Math.max(0, p.life/100);

          if(p.sparkle && Math.random()<0.12){
            ctx.fillStyle = 'rgba(255,255,255,.85)';
            ctx.fillRect(p.x,p.y,1.1*DPR,1.1*DPR);
          }

          ctx.globalAlpha = p.alpha;
          ctx.fillStyle = p.color;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,TAU); ctx.fill();
          ctx.globalAlpha = 1;

          if(p.alpha<=0 || p.x<-50 || p.x>W+50 || p.y>H+50) particles.splice(i,1);
        }

        // Автозапуск салютов (редко, чтобы не «моргало»)
        if(Math.random() < (isPhone()? 0.028 : 0.05)) spawnRocket();

        requestAnimationFrame(step);
      }

      // Стартовый залп (урезан)
      for(let i=0;i<(isPhone()?2:3);i++) setTimeout(()=>spawnRocket(), i*260);
      requestAnimationFrame(step);
    })();
  </script>
</body>
</html>
